<HTML>
<HEAD>
<TITLE>
sector.cpp
</TITLE>
</HEAD>
<BODY>
<PRE>
<font color="blue">#include</font> <font color="maroon">"sector.h"</font>

<font color="blue">namespace</font> cache <font color="black">{</font>

Sector<font color="black">:</font><font color="black">:</font>~Sector<font color="black">(</font><font color="black">)</font><font color="black">{</font>
    <font color="blue">while</font> <font color="black">(</font><font color="black">!</font> collision_maps.empty<font color="black">(</font><font color="black">)</font><font color="black">)</font> <font color="black">{</font>
        byte<font color="black">*</font> elem <font color="black">=</font> collision_maps.back<font color="black">(</font><font color="black">)</font>;
        collision_maps.pop_back<font color="black">(</font><font color="black">)</font>;
        <font color="blue">delete</font> elem;
    <font color="black">}</font>
<font color="black">}</font>

uint Sector<font color="black">:</font><font color="black">:</font>getIndexForPlane<font color="black">(</font><font color="blue">int</font> z<font color="black">)</font><font color="black">{</font>
    <font color="blue">if</font> <font color="black">(</font>z <font color="black">&#60;</font> <font color="maroon">0</font><font color="black">)</font> <font color="black">{</font>
        <font color="blue">return</font> <font color="maroon">-2</font> <font color="black">*</font> z;
    <font color="black">}</font> <font color="blue">else</font> <font color="blue">if</font> <font color="black">(</font>z <font color="black">&#62;</font> <font color="maroon">0</font><font color="black">)</font> <font color="black">{</font>
        <font color="blue">return</font> <font color="maroon">2</font> <font color="black">*</font> <font color="black">(</font>z <font color="maroon">-1</font><font color="black">)</font>;
    <font color="black">}</font> <font color="blue">else</font> <font color="black">{</font>
        <font color="blue">return</font> <font color="maroon">0</font>;
    <font color="black">}</font>    
<font color="black">}</font>

JNIObject Sector<font color="black">:</font><font color="black">:</font>getObject<font color="black">(</font><font color="black">)</font><font color="black">{</font>
  <font color="blue">return</font> JNIObject<font color="black">(</font><font color="black">)</font>;
<font color="black">}</font>

<font color="blue">void</font> Sector<font color="black">:</font><font color="black">:</font>setObject<font color="black">(</font><font color="black">)</font><font color="black">{</font>
<font color="black">}</font>

byte Sector<font color="black">:</font><font color="black">:</font>getObjectCount<font color="black">(</font><font color="black">)</font><font color="black">{</font>
    <font color="blue">return</font> objects.size<font color="black">(</font><font color="black">)</font>;
<font color="black">}</font>

<font color="blue">void</font> Sector<font color="black">:</font><font color="black">:</font>removeCollisionMap<font color="black">(</font><font color="blue">int</font> z<font color="black">)</font><font color="black">{</font>
    <font color="blue">int</font> index <font color="black">=</font> static_cast<font color="black">&#60;</font><font color="blue">int</font><font color="black">&#62;</font><font color="black">(</font>getIndexForPlane<font color="black">(</font>z<font color="black">)</font><font color="black">)</font>;
    <font color="blue">while</font><font color="black">(</font>collision_maps.size<font color="black">(</font><font color="black">)</font><font color="black">&#62;</font><font color="black">=</font> index<font color="black">)</font><font color="black">{</font>
        byte<font color="black">*</font> elem <font color="black">=</font> collision_maps.back<font color="black">(</font><font color="black">)</font>;
        <font color="blue">delete</font> elem;
        collision_maps.pop_back<font color="black">(</font><font color="black">)</font>;
    <font color="black">}</font>
<font color="black">}</font>

byte Sector<font color="black">:</font><font color="black">:</font>getCollision<font color="black">(</font>byte x,byte y, <font color="blue">int</font> z<font color="black">)</font><font color="black">{</font>    
    ensurePlane<font color="black">(</font>z<font color="black">)</font>;
    byte<font color="black">*</font> map <font color="black">=</font> collision_maps.at<font color="black">(</font>z<font color="black">)</font>;
    <font color="blue">return</font> map<font color="black">[</font><font color="maroon">64</font><font color="black">*</font>x <font color="black">+</font> y<font color="black">]</font>;
<font color="black">}</font>

<font color="blue">void</font> Sector<font color="black">:</font><font color="black">:</font>setCollision<font color="black">(</font>byte x,byte y, <font color="blue">int</font> z, byte value<font color="black">)</font><font color="black">{</font>
    ensurePlane<font color="black">(</font>z<font color="black">)</font>;
    byte<font color="black">*</font> map <font color="black">=</font> collision_maps.at<font color="black">(</font>z<font color="black">)</font>;
    map<font color="black">[</font><font color="maroon">64</font><font color="black">*</font>x <font color="black">+</font> y<font color="black">]</font> <font color="black">=</font> value;
<font color="black">}</font>

<font color="blue">void</font> Sector<font color="black">:</font><font color="black">:</font>ensurePlane<font color="black">(</font><font color="blue">int</font> z<font color="black">)</font><font color="black">{</font>
    <font color="blue">int</font> index <font color="black">=</font> static_cast<font color="black">&#60;</font><font color="blue">int</font><font color="black">&#62;</font><font color="black">(</font>getIndexForPlane<font color="black">(</font>z<font color="black">)</font><font color="black">)</font>;
    <font color="blue">while</font><font color="black">(</font>collision_maps.size<font color="black">(</font><font color="black">)</font><font color="black">&#60;</font><font color="black">=</font>index<font color="black">)</font><font color="black">{</font>
        collision_maps.push_back<font color="black">(</font><font color="blue">new</font> byte<font color="black">[</font><font color="maroon">64</font><font color="black">*</font><font color="maroon">64</font><font color="black">]</font><font color="black">)</font>;
    <font color="black">}</font>
<font color="black">}</font>

<font color="black">}</font>

</PRE>
</BODY>
</HTML>
